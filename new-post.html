<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Goga - funny & memes</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,  maximum-scale=1">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="HandheldFriendly" content="True">
	
	<link rel="shortcut icon" href="img/favicon.png">

	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/materialize.min.css">
	<link rel="stylesheet" href="css/slick.css">
	<link rel="stylesheet" href="css/slick-theme.css">
	<link rel="stylesheet" href="css/owl.carousel.css">
	<link rel="stylesheet" href="css/owl.theme.css">
	<link rel="stylesheet" href="css/owl.transitions.css">
	<link rel="stylesheet" href="css/lightbox.min.css">
	<link rel="stylesheet" type="text/css" href="css/loading.css" />
	<link rel="stylesheet" type="text/css" href="css/loading-btn.css" />
	<link rel="stylesheet" href="css/style.css">

</head>
<body>

	<!-- navbar -->
	<div class="navbar">
		<div class="container">
			
			<div class="site-title">
				<a href="index-mobile.html" class="logo"><h1>Goga</h1></a>
			</div>
			<div class="panel-control-right">
				<a href="#" data-activates="slide-out-right" class="sidenav-control-right"><i class="fa fa-user"></i></a>
			</div>
		</div>
	</div>
	<!-- end navbar -->

	<!-- panel control left -->
	
	<!-- end panel control left -->

	<!-- panel control right -->
	<div class="panel-control-right">
			<ul id="slide-out-right" class="side-nav collapsible right-aligned" data-collapsible="accordion" style="transform: translateX(100%);">
				<li>
					<div class="photos">
						<img id="photop" src="img/photos.png" alt="">
						<div id="name">
						<h3>Jhon Doe</h3>
					</div>
					</div>
				</li>
				<li>
					<a href="index-mobile.html"><i class="fa fa-home"></i>Home</a>           
			</li>
				<li>
					<a href="settings.html"><i class="fa fa-cog"></i>Settings</a>
				</li>
				<li>
					<a href="author-page.html"><i class="fa fa-list"></i>My Posts</a>
				</li>
				<li>
					<a href="login.html"><i class="fa fa-sign-out"></i>Sign-out</a>
				</li>
				
			</ul>
		</div>
	<!-- end panel control right -->




	<!-- register-->
	<div class="register app-pages app-section">
		<div class="container">
			<div class="pages-title">
				<h3>Add new post</h3>
			</div>
			<form  id="AddPostForm" onsubmit="return false">
				<div class="avatar-upload">
					<div class="avatar-edit">
						<input type='file' id="imageUpload" accept=".png, .jpg, .jpeg, .gif" />
						<label for="imageUpload"></label>
					</div>
					<div class="avatar-preview">
						<div id="imagePreview" style="background-image: url(./img/fa-image.png);">
						</div>
					</div>
				</div>
				

				<div class="post">
					<div class="entry" id="preview" style="display:none;">
					</div>
				</div>
				
				<input type="text" id="descrition" placeholder="Short description">

				<span class="helper-text" id='message'></span>
					
					<div>
						<div id="msg" style="width: 75%;display:none;margin:0 auto 5px auto">Post Added Successfully</div>
					</div>
				<button class="button ld-over" onclick="uploadImage()" id="register">Post
					<div class="ld ld-ring ld-spin"></div>

			</button>
			</form>
			
		</div>
	</div>
	<!-- end register -->
	
	
	
	<!-- script -->
	<script src="js/jquery.min.js"></script>
	<script src="js/materialize.min.js"></script>
	<script src="js/slick.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/custom.js"></script>
	<script>




    setDefaultEvents();
    /**
     * Handles the hardware key events.
     * @private
     * @param {Object} event - The object contains data of key event
     */
	 function keyEventHandler(event) {
			if (event.keyName === "back") {
					try {
							window.history.back();
					} catch (ignore) {
							tizen.application.getCurrentApplication().exit();

					}
			}
	}
    /**
     * Sets default event listeners.
     * @private
     */
    function setDefaultEvents() {
        document.addEventListener("tizenhwkey", keyEventHandler);
    }



   
		document.getElementById("name").innerHTML =   localStorage.getItem("username");


var photo1 = localStorage.getItem("profilepicture");

document.getElementById("photop").src = "http://41.226.11.243:10003/api/attachments/profilepicture/download/" + photo1;

setDefaultEvents();
/**
     * Handles the hardware key events.
     * @private
     * @param {Object} event - The object contains data of key event
     */
	 function keyEventHandler(event) {
        if (event.keyName === "back") {
            try {
                tizen.application.getCurrentApplication().exit();
            } catch (ignore) {}
        }
    }
		 /**
     * Sets default event listeners.
     * @private
     */
	 function setDefaultEvents() {
        document.addEventListener("tizenhwkey", keyEventHandler);
    }
	var filename;
	var strImage;
	var image;
		

			function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('#imagePreview').css('background-image', 'url('+e.target.result +')');
            $('#imagePreview').hide();
            $('#imagePreview').fadeIn(650);
        }
		reader.readAsDataURL(input.files[0]);
		image = input.files[0];
		filename = input.files[0].name;
    }
}
$("#imageUpload").change(function() {
    readURL(this);
});
function uploadImage(){


	document.getElementById("register").className += " running";



	 const url = 'http://41.226.11.243:10003/api/attachments/images/upload';
	 var fd = new FormData();
    // The data we are going to send in our request
    fd.append('file',image)
    // Create our request constructor with all the parameters we need
    var request = new Request(url, {
        method: 'POST', 
        
        body: fd
	});
	console.log("fd ",image)
  if(image && fd!=null && $("#descrition").val()!="")  
    {
		fetch(request)
    .then(data=> {
        if(data.ok){
			SaveProduct();			
        }else{
            console.log("error upload ", data)

              
    }
        // Handle response we get from the API
    }).catch(err=>{

        console.log("upload ",err)
    })}else {
		window.Materialize.toast('you need to choose image and write something !', 4000)
		document.getElementById("register").className = "button ld-over";


	}


}
			function SaveProduct() {
			//loader show 

		
			///////////////////////////////
			var userId =  localStorage.getItem("loginDetails");
    const url = 'http://41.226.11.243:10003/api/posts';
    // The data we are going to send in our request
    let data = {
        userId: userId,
		title:$("#descrition").val(),
		type:filename
    }
    console.info(data);
    // Create our request constructor with all the parameters we need
    var request = new Request(url, {
        method: 'POST', 
        headers: {
            "Content-Type": "application/json; charset=utf-8",
            // "Content-Type": "application/x-www-form-urlencoded",
        },
        body: JSON.stringify(data)
    });
    
    fetch(request)
    .then(data=> {
        if(data.ok){
					$("#msg").css("display", "block");
					$('#msg').fadeIn();
					$('#msg').fadeOut(2000, function () { window.location.href = "index-mobile.html"; }
					);
        }else{
            console.log("error submit ", data)

              
    }
        // Handle response we get from the API
    }).catch(err=>{

        console.log("post ",err)
    })




		}
		</script>
</body>

</html>